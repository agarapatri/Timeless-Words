<!doctype html>
<meta charset="utf-8" />
<title>sqlite-vec POC</title>

<script type="module">
  // Load from your repo, not a CDN
  import init from "/js/sql_helpers/sqlite3.mjs";   // or "../js/sql_helpers/sqlite3.mjs" if you're not serving from the repo root

  // Make sure the loader finds the wasm next to the mjs
  const sqlite3 = await init({
    // Either of these is fine; keep one:
    locateFile: (path) => `/js/sql_helpers/${path}`,
    // wasmURL: new URL("/js/sql_helpers/sqlite3.wasm", window.location).href,
    // workerURL: new URL("/js/sql_helpers/sqlite.worker.js", window.location).href, // only if your build uses it
  });

  const db = new sqlite3.oo1.DB(":memory:");

  // Confirm sqlite-vec is present
  const [vecVer] = db.selectArray("select vec_version();");
  console.log("sqlite-vec version:", vecVer);

  // Minimal vector table + search
  db.exec(`
    create virtual table myvec using vec0( dim=3 );
    insert into myvec(rowid, value) values
      (1, '[0.0, 1.0, 0.0]'),
      (2, '[1.0, 0.0, 0.0]'),
      (3, '[0.0, 0.0, 1.0]');
  `);

  const q = "[0.0, 0.9, 0.1]";
  const rows = db.selectArrays(`
    select rowid, distance
    from myvec
    where myvec match ?
    order by distance asc
    limit 2
  `, q);

  console.log("NN:", rows);
  db.close();
  document.body.innerHTML =
    `<pre>vec_version(): ${vecVer}\nNN: ${JSON.stringify(rows, null, 2)}</pre>`;
</script>
